# Phase 4: 整合部署 - 任务清单

## 文档信息

- **项目**: AI 研究助手
- **阶段**: Phase 4 - 整合部署
- **版本**: 1.0
- **创建日期**: 2025-10-30
- **预计时间**: 8-10 天（64-80 小时）
- **状态**: 待执行

---

## 任务概览

本阶段包含 **60 个任务**，分为 **8 个主要模块**：

1. **项目结构整合** (8 个任务，4 小时)
2. **环境变量配置** (6 个任务，3 小时)
3. **本地开发环境** (10 个任务，8 小时)
4. **数据库部署** (6 个任务，4 小时)
5. **后端部署** (8 个任务，8 小时)
6. **前端部署** (6 个任务，6 小时)
7. **测试和验收** (12 个任务，24 小时)
8. **监控和文档** (4 个任务，8 小时)

**标记说明**:
- `[ ]` 未完成
- `[x]` 已完成
- `*` 可选任务（文档编写）

---

## Week 1: 准备与配置（32 小时）

### Day 1: 项目结构整合（4 小时）

#### - [ ] 1.1 备份当前代码

- 创建 Git 分支 `phase4-deployment`
- 提交当前所有更改
- 推送到远程仓库
- 创建本地备份
- _需求: Requirement 1_
- _预计时间: 15 分钟_

#### - [ ] 1.2 移动前端目录

- 将 `achive/ai-chatbot-main` 移动到 `ai-chatbot-main`
- 使用 `git mv` 保持历史
- 验证文件完整性
- 删除空的 `achive/` 目录
- _需求: Requirement 1_
- _预计时间: 30 分钟_

#### - [ ] 1.3 更新 .gitignore

- 在根目录添加 `.env.local`
- 在根目录添加 `*.log`
- 在 `ai-chatbot-main/` 添加 `.env.local`
- 验证敏感文件不被追踪
- _需求: Requirement 1_
- _预计时间: 15 分钟_

#### - [ ] 1.4 创建 Dockerfile.backend

- 创建文件 `Dockerfile.backend`
- 使用 Python 3.11-slim 基础镜像
- 安装系统依赖
- 复制并安装 Python 依赖
- 配置启动命令
- 添加健康检查
- _需求: Requirement 5_
- _预计时间: 45 分钟_

#### - [ ] 1.5 创建 docker-compose.yml

- 创建文件 `docker-compose.yml`
- 定义 postgres 服务
- 定义 backend 服务
- 定义 frontend 服务
- 配置服务依赖
- 配置卷挂载
- _需求: Requirement 4_
- _预计时间: 1 小时_

#### - [ ] 1.6 创建统一 README

- 创建根目录 `README.md`
- 添加项目简介
- 添加项目结构说明
- 添加快速开始指南
- 添加部署指南链接
- _需求: Requirement 18_
- _预计时间: 45 分钟_

#### - [ ] 1.7 验证项目结构

- 检查目录结构正确
- 检查文件完整性
- 运行 `tree -L 2` 验证
- 提交更改
- _需求: Requirement 1_
- _预计时间: 15 分钟_

#### - [ ] 1.8 推送到 GitHub

- 推送分支到远程
- 创建 Pull Request
- 添加 PR 描述
- 请求代码审查（如需要）
- _需求: Requirement 1_
- _预计时间: 15 分钟_

### Day 2: 环境变量配置（3 小时）

#### - [ ] 2.1 创建后端环境变量示例

- 创建文件 `.env.example`
- 添加所有必需的环境变量
- 添加变量说明注释
- 设置示例值
- _需求: Requirement 2_
- _预计时间: 30 分钟_

#### - [ ] 2.2 创建前端环境变量示例

- 创建文件 `ai-chatbot-main/.env.example`
- 添加所有必需的环境变量
- 添加变量说明注释
- 设置示例值
- _需求: Requirement 2_
- _预计时间: 30 分钟_

#### - [ ] 2.3 创建本地环境变量文件

- 创建文件 `.env.local`
- 复制 `.env.example` 内容
- 填入实际的 API Keys
- 配置本地数据库 URL
- 验证不被 Git 追踪
- _需求: Requirement 2_
- _预计时间: 30 分钟_

#### - [ ] 2.4 创建环境变量检查脚本

- 创建文件 `scripts/check-env.sh`
- 检查后端必需变量
- 检查前端必需变量
- 提供清晰的错误信息
- 添加执行权限
- _需求: Requirement 2_
- _预计时间: 45 分钟_

#### - [ ] 2.5 测试环境变量

- 运行检查脚本
- 验证所有变量存在
- 验证变量格式正确
- 修复发现的问题
- _需求: Requirement 2_
- _预计时间: 30 分钟_

#### - [ ] 2.6 更新 README 环境变量说明

- 在 README 中添加环境变量章节
- 说明如何配置
- 提供示例
- 添加故障排查提示
- _需求: Requirement 2, 18_
- _预计时间: 15 分钟_

### Day 3: 本地开发环境（直接运行）（4 小时）

#### - [ ] 3.1 准备本地 PostgreSQL

- 使用 Docker 启动 PostgreSQL
- 或安装本地 PostgreSQL
- 或使用 Neon 开发数据库
- 验证数据库可访问
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.2 配置后端环境

- 进入项目根目录
- 创建 Python 虚拟环境
- 安装依赖 `pip install -r requirements.txt`
- 验证依赖安装成功
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.3 启动后端服务

- 运行 `uvicorn main:app --reload --port 8000`
- 验证服务启动成功
- 访问 `http://localhost:8000/docs`
- 测试健康检查接口
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.4 配置前端环境

- 进入 `ai-chatbot-main/` 目录
- 运行 `npm install`
- 验证依赖安装成功
- 检查 Node.js 版本 >= 18
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.5 运行数据库迁移

- 在前端目录运行 `npm run db:migrate`
- 验证所有表创建成功
- 运行 `npm run db:studio` 查看数据库
- 验证 Schema 正确
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.6 启动前端服务

- 运行 `npm run dev`
- 验证服务启动成功
- 访问 `http://localhost:3000`
- 检查控制台无错误
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.7 测试前后端通信

- 在前端发起 API 请求
- 验证后端接收请求
- 检查 CORS 配置
- 验证响应正确
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.8 测试完整流程

- 注册/登录用户
- 发起研究任务
- 验证 SSE 连接
- 验证进度显示
- 验证报告生成
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.9 创建启动脚本

- 创建 `scripts/dev.sh`
- 自动启动所有服务
- 添加日志输出
- 添加错误处理
- _需求: Requirement 3_
- _预计时间: 30 分钟_

#### - [ ] 3.10 更新 README 本地开发说明

- 添加本地开发章节
- 提供详细步骤
- 添加常见问题
- 添加故障排查
- _需求: Requirement 3, 18_
- _预计时间: 15 分钟_

### Day 4: 本地开发环境（Docker）（4 小时）

#### - [ ] 4.1 构建后端 Docker 镜像

- 运行 `docker build -f Dockerfile.backend -t research-backend .`
- 验证构建成功
- 检查镜像大小
- 优化镜像（如需要）
- _需求: Requirement 4_
- _预计时间: 45 分钟_

#### - [ ] 4.2 构建前端 Docker 镜像

- 在 `ai-chatbot-main/` 创建 Dockerfile
- 运行 `docker build -t research-frontend .`
- 验证构建成功
- 检查镜像大小
- _需求: Requirement 4_
- _预计时间: 45 分钟_

#### - [ ] 4.3 测试 Docker Compose

- 运行 `docker-compose up -d`
- 验证所有服务启动
- 检查服务健康状态
- 查看日志 `docker-compose logs -f`
- _需求: Requirement 4_
- _预计时间: 30 分钟_

#### - [ ] 4.4 测试 Docker 环境

- 访问前端 `http://localhost:3000`
- 访问后端 `http://localhost:8000`
- 测试完整流程
- 验证数据持久化
- _需求: Requirement 4_
- _预计时间: 45 分钟_

#### - [ ] 4.5 优化 Docker 配置

- 配置代码热重载
- 优化构建缓存
- 减小镜像体积
- 添加健康检查
- _需求: Requirement 4_
- _预计时间: 45 分钟_

#### - [ ] 4.6 更新 README Docker 说明

- 添加 Docker 使用章节
- 提供启动命令
- 添加常见问题
- 添加故障排查
- _需求: Requirement 4, 18_
- _预计时间: 30 分钟_

---

## Week 2: 部署与测试（48 小时）

### Day 5: 数据库部署（4 小时）

#### - [ ] 5.1 创建 Neon 项目

- 访问 https://neon.tech
- 注册/登录账号
- 创建新项目
- 选择区域（US East）
- 记录项目信息
- _需求: Requirement 6_
- _预计时间: 30 分钟_

#### - [ ] 5.2 获取数据库连接字符串

- 在 Neon 控制台获取连接字符串
- 确保包含 `sslmode=require`
- 测试连接 `psql $DATABASE_URL`
- 记录连接信息
- _需求: Requirement 6_
- _预计时间: 15 分钟_

#### - [ ] 5.3 配置生产数据库环境变量

- 更新 `.env.local` 使用 Neon URL
- 测试本地连接 Neon
- 验证 SSL 连接
- 记录配置
- _需求: Requirement 6_
- _预计时间: 30 分钟_

#### - [ ] 5.4 运行生产数据库迁移

- 在本地运行 `npm run db:migrate`
- 验证所有表创建成功
- 运行 `npm run db:studio` 查看
- 验证 Schema 正确
- _需求: Requirement 6_
- _预计时间: 45 分钟_

#### - [ ] 5.5 测试数据库性能

- 插入测试数据
- 测试查询性能
- 测试并发连接
- 验证索引效果
- _需求: Requirement 6_
- _预计时间: 1 小时_

#### - [ ] 5.6 配置数据库备份

- 在 Neon 控制台配置自动备份
- 测试手动备份
- 验证备份恢复
- 记录备份策略
- _需求: Requirement 16_
- _预计时间: 1 小时_


### Day 6: 后端部署到 Render（8 小时）

#### - [ ] 6.1 创建 Render 账号

- 访问 https://render.com
- 注册/登录账号
- 连接 GitHub 账号
- 验证邮箱
- _需求: Requirement 7_
- _预计时间: 15 分钟_

#### - [ ] 6.2 创建 Web Service

- 点击 "New +" → "Web Service"
- 选择 GitHub 仓库
- 选择 `agentic-ai-public-main`
- 配置服务名称 `research-backend`
- 选择区域 `Oregon (US West)`
- _需求: Requirement 7_
- _预计时间: 30 分钟_

#### - [ ] 6.3 配置构建设置

- Runtime: Docker
- Dockerfile Path: `Dockerfile.backend`
- Branch: `main`
- Auto-Deploy: Yes
- 验证配置正确
- _需求: Requirement 7_
- _预计时间: 15 分钟_

#### - [ ] 6.4 配置环境变量

- 添加 `DEEPSEEK_API_KEY`
- 添加 `OPENAI_API_KEY`
- 添加 `TAVILY_API_KEY`
- 添加 `DATABASE_URL`（Neon）
- 添加 `ALLOWED_ORIGINS`（暂时用占位符）
- 验证所有变量正确
- _需求: Requirement 7_
- _预计时间: 30 分钟_

#### - [ ] 6.5 配置健康检查

- Health Check Path: `/api/health`
- Health Check Interval: 30s
- Health Check Timeout: 10s
- 验证配置
- _需求: Requirement 7_
- _预计时间: 15 分钟_

#### - [ ] 6.6 部署后端

- 点击 "Create Web Service"
- 等待构建完成（约 5-10 分钟）
- 查看构建日志
- 验证部署成功
- _需求: Requirement 7_
- _预计时间: 1 小时_

#### - [ ] 6.7 获取后端 URL

- 记录 Render URL: `https://research-backend.onrender.com`
- 测试健康检查: `curl https://research-backend.onrender.com/api/health`
- 测试 API 文档: 访问 `/docs`
- 验证响应正确
- _需求: Requirement 7_
- _预计时间: 30 分钟_

#### - [ ] 6.8 测试后端功能

- 测试模型列表接口
- 测试研究接口（使用 curl）
- 测试 SSE 流式响应
- 验证数据库连接
- 检查日志无错误
- _需求: Requirement 7_
- _预计时间: 1 小时_

### Day 7: 前端部署到 Vercel（6 小时）

#### - [ ] 7.1 安装 Vercel CLI

- 运行 `npm i -g vercel`
- 验证安装成功 `vercel --version`
- 登录 `vercel login`
- 验证登录成功
- _需求: Requirement 8_
- _预计时间: 15 分钟_

#### - [ ] 7.2 首次部署

- 进入 `ai-chatbot-main/` 目录
- 运行 `vercel`
- 选择项目设置
- 等待部署完成
- 获取预览 URL
- _需求: Requirement 8_
- _预计时间: 30 分钟_

#### - [ ] 7.3 配置环境变量

- 运行 `vercel env add DATABASE_URL`
- 输入 Neon 连接字符串
- 运行 `vercel env add RESEARCH_API_URL`
- 输入 Render URL
- 运行 `vercel env add AUTH_SECRET`
- 生成并输入随机字符串（32+ 字符）
- 运行 `vercel env add NEXTAUTH_URL`
- 输入 Vercel 生产 URL（稍后更新）
- _需求: Requirement 8_
- _预计时间: 45 分钟_

#### - [ ] 7.4 生产部署

- 运行 `vercel --prod`
- 等待部署完成
- 获取生产 URL: `https://your-app.vercel.app`
- 记录 URL
- _需求: Requirement 8_
- _预计时间: 30 分钟_

#### - [ ] 7.5 更新 NEXTAUTH_URL

- 运行 `vercel env add NEXTAUTH_URL`
- 输入实际的生产 URL
- 选择 Production 环境
- 重新部署 `vercel --prod`
- _需求: Requirement 8_
- _预计时间: 15 分钟_

#### - [ ] 7.6 测试前端功能

- 访问生产 URL
- 测试页面加载
- 测试用户注册/登录
- 测试基本功能
- 检查控制台无错误
- _需求: Requirement 8_
- _预计时间: 1 小时_

### Day 8: CORS 和联调（4 小时）

#### - [ ] 8.1 更新后端 CORS 配置

- 在 Render 更新 `ALLOWED_ORIGINS` 环境变量
- 添加 Vercel 生产域名
- 添加 Vercel 预览域名通配符
- 格式: `https://your-app.vercel.app,https://your-app-*.vercel.app`
- 重新部署后端
- _需求: Requirement 9_
- _预计时间: 30 分钟_

#### - [ ] 8.2 测试 CORS

- 在前端发起 API 请求
- 检查浏览器控制台
- 验证无 CORS 错误
- 测试不同的请求方法
- _需求: Requirement 9_
- _预计时间: 30 分钟_

#### - [ ] 8.3 测试完整流程

- 在生产环境注册用户
- 发起研究任务
- 验证 SSE 连接
- 验证进度显示
- 验证报告生成
- _需求: Requirement 9_
- _预计时间: 1 小时_

#### - [ ] 8.4 测试追问功能

- 对已有报告追问
- 验证报告更新
- 测试多次追问
- 验证历史记录
- _需求: Requirement 9_
- _预计时间: 45 分钟_

#### - [ ] 8.5 测试错误处理

- 模拟网络错误
- 验证错误提示
- 测试重连机制
- 验证用户体验
- _需求: Requirement 9_
- _预计时间: 45 分钟_

#### - [ ] 8.6 记录问题和优化

- 记录发现的问题
- 制定优化计划
- 更新文档
- 提交问题到 GitHub Issues
- _需求: Requirement 9_
- _预计时间: 30 分钟_

### Day 9: 防休眠和监控（4 小时）

#### - [ ] 9.1 注册 cron-job.org

- 访问 https://cron-job.org
- 注册免费账号
- 验证邮箱
- 登录控制台
- _需求: Requirement 10_
- _预计时间: 15 分钟_

#### - [ ] 9.2 创建防休眠任务

- 点击 "Create cronjob"
- Title: `Keep Render Alive`
- URL: `https://research-backend.onrender.com/api/health`
- Schedule: `*/10 * * * *`（每 10 分钟）
- Method: GET
- Timeout: 30s
- _需求: Requirement 10_
- _预计时间: 30 分钟_

#### - [ ] 9.3 配置告警

- 启用失败通知
- 配置邮件告警
- 设置连续失败 3 次后通知
- 测试告警
- _需求: Requirement 10_
- _预计时间: 30 分钟_

#### - [ ] 9.4 测试防休眠

- 等待 15 分钟（Render 休眠时间）
- 检查服务是否保持活跃
- 测试冷启动时间
- 验证防休眠工作
- _需求: Requirement 10_
- _预计时间: 1 小时_

#### - [ ] 9.5 配置 Render 监控

- 在 Render 控制台查看监控
- 配置告警规则
- 设置 CPU/内存阈值
- 配置邮件通知
- _需求: Requirement 15_
- _预计时间: 30 分钟_

#### - [ ] 9.6 配置 Vercel Analytics

- 在 Vercel 项目设置中启用 Analytics
- 配置 Core Web Vitals 监控
- 查看实时数据
- 设置告警（如需要）
- _需求: Requirement 15_
- _预计时间: 30 分钟_

#### - [ ] 9.7 配置 Neon 监控

- 在 Neon 控制台查看监控
- 检查连接数
- 检查查询性能
- 检查存储使用
- _需求: Requirement 15_
- _预计时间: 30 分钟_

#### - [ ] 9.8 配置 UptimeRobot（可选）

- 访问 https://uptimerobot.com
- 注册免费账号
- 添加前端监控
- 添加后端监控
- 配置告警
- _需求: Requirement 15_
- _预计时间: 30 分钟_

---

## Week 2: 测试和完善（32 小时）

### Day 10-11: 端到端测试（16 小时）

#### - [ ] 10.1 准备测试环境

- 安装 Playwright `npm i -D @playwright/test`
- 初始化配置 `npx playwright install`
- 创建测试目录 `tests/e2e/`
- 配置测试环境变量
- _需求: Requirement 11_
- _预计时间: 1 小时_

#### - [ ] 10.2 编写用户注册测试

- 创建测试文件 `auth.spec.ts`
- 测试注册流程
- 测试登录流程
- 测试 session 验证
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 2 小时_

#### - [ ] 10.3 编写研究任务测试

- 创建测试文件 `research.spec.ts`
- 测试发起研究任务
- 测试 AI 调用 startResearch 工具
- 测试 taskId 返回
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 2 小时_

#### - [ ] 10.4 编写进度显示测试

- 测试 SSE 连接建立
- 测试进度事件接收
- 测试进度信息显示
- 测试进度更新
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 2 小时_

#### - [ ] 10.5 编写报告生成测试

- 测试研究完成事件
- 测试 Artifact 自动创建
- 测试 Markdown 渲染
- 测试报告内容
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 2 小时_

#### - [ ] 10.6 编写追问测试

- 测试用户追问
- 测试 AI 理解追问
- 测试报告更新
- 测试 Artifact 更新
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 2 小时_

#### - [ ] 10.7 编写历史记录测试

- 测试历史任务保存
- 测试历史列表查询
- 测试历史详情查看
- 测试数据正确性
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 2 小时_

#### - [ ] 10.8 编写错误处理测试

- 测试网络错误
- 测试 API 错误
- 测试超时错误
- 测试错误提示
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 2 小时_

#### - [ ] 10.9 编写重连测试

- 测试 SSE 断线
- 测试自动重连
- 测试状态恢复
- 测试重连限制
- 运行测试验证
- _需求: Requirement 11_
- _预计时间: 1 小时_

### Day 12: 性能测试（8 小时）

#### - [ ] 12.1 测试页面加载性能

- 使用 Lighthouse 测试
- 测试首屏加载时间
- 测试 Core Web Vitals
- 记录性能指标
- 分析优化点
- _需求: Requirement 12_
- _预计时间: 2 小时_

#### - [ ] 12.2 测试 API 响应性能

- 测试健康检查响应时间
- 测试研究接口响应时间
- 测试 SSE 连接时间
- 记录性能指标
- 分析优化点
- _需求: Requirement 12_
- _预计时间: 2 小时_

#### - [ ] 12.3 测试并发性能

- 使用 Apache Bench 测试
- 测试 5 个并发用户
- 测试 10 个并发用户
- 记录性能指标
- 分析瓶颈
- _需求: Requirement 12_
- _预计时间: 2 小时_

#### - [ ] 12.4 测试长时间稳定性

- 启动 24 小时稳定性测试
- 监控内存使用
- 监控 CPU 使用
- 监控错误日志
- 记录测试结果
- _需求: Requirement 12_
- _预计时间: 2 小时（设置和监控）_

### Day 13: 兼容性测试（8 小时）

#### - [ ] 13.1 测试 Chrome 桌面版

- 测试完整功能
- 测试性能
- 测试用户体验
- 记录问题
- _需求: Requirement 13_
- _预计时间: 1 小时_

#### - [ ] 13.2 测试 Chrome 移动版

- 测试完整功能
- 测试响应式布局
- 测试触摸操作
- 记录问题
- _需求: Requirement 13_
- _预计时间: 1 小时_

#### - [ ] 13.3 测试 Safari 桌面版

- 测试完整功能
- 测试 SSE 兼容性
- 测试性能
- 记录问题
- _需求: Requirement 13_
- _预计时间: 1 小时_

#### - [ ] 13.4 测试 Safari 移动版（iOS）

- 测试完整功能
- 测试响应式布局
- 测试 PWA 功能
- 记录问题
- _需求: Requirement 13_
- _预计时间: 1 小时_

#### - [ ] 13.5 测试 Firefox 桌面版

- 测试完整功能
- 测试 SSE 兼容性
- 测试性能
- 记录问题
- _需求: Requirement 13_
- _预计时间: 1 小时_

#### - [ ] 13.6 测试 Edge 桌面版

- 测试完整功能
- 测试性能
- 记录问题
- _需求: Requirement 13_
- _预计时间: 1 小时_

#### - [ ] 13.7 测试不同网络环境

- 测试 4G 网络
- 测试 3G 网络
- 测试弱网环境
- 记录性能影响
- _需求: Requirement 13_
- _预计时间: 1 小时_

#### - [ ] 13.8 汇总兼容性测试结果

- 整理测试结果
- 分析问题
- 制定修复计划
- 更新文档
- _需求: Requirement 13_
- _预计时间: 1 小时_

---

## Week 3: 完善和文档（16 小时）

### Day 14: 安全和优化（8 小时）

#### - [ ] 14.1 安全审计

- 检查 API Key 管理
- 检查数据库连接安全
- 检查 CORS 配置
- 检查认证机制
- 检查日志安全
- _需求: Requirement 14_
- _预计时间: 2 小时_

#### - [ ] 14.2 修复安全问题

- 修复发现的安全问题
- 更新配置
- 测试修复效果
- 记录修复内容
- _需求: Requirement 14_
- _预计时间: 2 小时_

#### - [ ] 14.3 性能优化

- 优化页面加载
- 优化 API 响应
- 优化数据库查询
- 优化资源使用
- _需求: Requirement 12_
- _预计时间: 2 小时_

#### - [ ] 14.4 成本优化

- 分析 API 调用成本
- 优化 API 使用
- 监控成本变化
- 记录优化效果
- _需求: Requirement 17_
- _预计时间: 2 小时_

### Day 15: 文档和验收（8 小时）

#### - [ ]* 15.1 编写部署文档

- 创建 `docs/DEPLOYMENT.md`
- 详细记录部署步骤
- 添加配置说明
- 添加故障排查
- _需求: Requirement 18_
- _预计时间: 2 小时_

#### - [ ]* 15.2 编写运维文档

- 创建 `docs/OPERATIONS.md`
- 记录监控配置
- 记录备份策略
- 记录回滚流程
- _需求: Requirement 18_
- _预计时间: 2 小时_

#### - [ ]* 15.3 编写故障排查文档

- 创建 `docs/TROUBLESHOOTING.md`
- 记录常见问题
- 提供解决方案
- 添加诊断步骤
- _需求: Requirement 18_
- _预计时间: 2 小时_

#### - [ ]* 15.4 更新 README

- 更新项目简介
- 更新快速开始
- 添加部署指南链接
- 添加贡献指南
- _需求: Requirement 18_
- _预计时间: 1 小时_

#### - [ ] 15.5 最终验收测试

- 运行所有测试
- 验证所有功能
- 检查文档完整性
- 确认验收标准
- _需求: Requirement 20_
- _预计时间: 1 小时_

---

## 验收标准

### 核心功能验收

- [ ] 项目结构整合完成
- [ ] 环境变量配置完整
- [ ] 本地开发环境正常（直接运行）
- [ ] 本地开发环境正常（Docker）
- [ ] 数据库部署成功
- [ ] 后端部署成功
- [ ] 前端部署成功
- [ ] CORS 配置正确
- [ ] 防休眠配置生效
- [ ] 端到端测试通过
- [ ] 性能测试通过
- [ ] 兼容性测试通过
- [ ] 安全配置完善
- [ ] 监控和日志正常
- [ ] 文档完整

### 数据验收

- [ ] 数据库 Schema 正确
- [ ] 数据迁移成功
- [ ] 数据备份正常
- [ ] 数据查询正常

### 性能验收

- [ ] 页面加载时间 < 3 秒
- [ ] API 响应时间 < 2 秒
- [ ] SSE 连接时间 < 2 秒
- [ ] 支持 5-10 个并发用户
- [ ] 24 小时稳定运行

---

## 时间估算

| 周次 | 模块 | 任务数 | 预计时间 |
|------|------|--------|----------|
| Week 1 | 准备与配置 | 24 | 32 小时 |
| Week 2 | 部署与测试 | 28 | 48 小时 |
| Week 3 | 完善和文档 | 8 | 16 小时 |
| **总计** | **8 个模块** | **60** | **96 小时** |

**实际工作日**: 12 天（每天 8 小时）

---

## 依赖关系

```
Phase 1 + Phase 2 + Phase 3 完成
    ↓
Week 1: 准备与配置
├── 项目结构整合
├── 环境变量配置
└── 本地开发环境
    ↓
Week 2: 部署与测试
├── 数据库部署
├── 后端部署
├── 前端部署
├── CORS 和联调
├── 防休眠和监控
└── 端到端测试
    ↓
Week 3: 完善和文档
├── 安全和优化
└── 文档和验收
```

---

## 风险和缓解

### 高风险

1. **Render 免费层休眠**
   - 缓解: 配置 cron-job.org 防休眠
   - 缓解: 考虑升级到 Starter 计划（$7/月）
   - 缓解: 提前测试冷启动时间

2. **CORS 配置错误**
   - 缓解: 详细的配置检查清单
   - 缓解: 充分的测试
   - 缓解: 清晰的错误提示

3. **环境变量管理混乱**
   - 缓解: 创建环境变量检查脚本
   - 缓解: 详细的文档说明
   - 缓解: 使用 .env.example 模板

### 中风险

4. **数据库迁移问题**
   - 缓解: 先在开发环境测试
   - 缓解: 备份数据库
   - 缓解: 渐进式迁移

5. **SSE 在生产环境不工作**
   - 缓解: 使用 Node.js runtime
   - 缓解: 正确的响应头配置
   - 缓解: 充分的测试

### 低风险

6. **成本超预算**
   - 缓解: 使用免费层服务
   - 缓解: 监控使用量
   - 缓解: 优化 API 调用

---

## 下一步行动

### 立即开始（Week 1 Day 1）

1. ✅ 备份当前代码 (任务 1.1)
2. ✅ 移动前端目录 (任务 1.2)
3. ✅ 更新 .gitignore (任务 1.3)

### Week 1 重点

- 完成项目结构整合
- 配置环境变量
- 建立本地开发环境

### Week 2 重点

- 完成数据库部署
- 完成前后端部署
- 完成端到端测试

### Week 3 重点

- 完善安全配置
- 优化性能
- 完成文档

---

**文档版本**: 1.0  
**最后更新**: 2025-10-30  
**状态**: 待执行
