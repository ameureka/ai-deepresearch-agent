# ğŸ—ï¸ AI Chatbot æŠ€æœ¯æ¶æ„æ·±åº¦åˆ†æ

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Chat UI   â”‚  â”‚ Artifact   â”‚  â”‚  Sidebar   â”‚              â”‚
â”‚  â”‚  ç»„ä»¶      â”‚  â”‚  ç¼–è¾‘å™¨    â”‚  â”‚  å¯¼èˆª      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â†“                â†“                â†“                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚        React Hooks (useChat, useSWR)         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Next.js App Router                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React Server Components (RSC)                         â”‚  â”‚
â”‚  â”‚  â€¢ æœåŠ¡ç«¯æ¸²æŸ“                                            â”‚  â”‚
â”‚  â”‚  â€¢ é›¶ JavaScript ä¼ è¾“                                    â”‚  â”‚
â”‚  â”‚  â€¢ ç›´æ¥æ•°æ®åº“è®¿é—®                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Server Actions                                         â”‚  â”‚
â”‚  â”‚  â€¢ saveChat, deleteChat                                 â”‚  â”‚
â”‚  â”‚  â€¢ saveDocument, deleteDocument                         â”‚  â”‚
â”‚  â”‚  â€¢ vote, saveSuggestion                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Routes                                             â”‚  â”‚
â”‚  â”‚  â€¢ /api/chat - èŠå¤©ç«¯ç‚¹                                  â”‚  â”‚
â”‚  â”‚  â€¢ /api/document - æ–‡æ¡£ç«¯ç‚¹                              â”‚  â”‚
â”‚  â”‚  â€¢ /api/files - æ–‡ä»¶ä¸Šä¼                                  â”‚  â”‚
â”‚  â”‚  â€¢ /api/history - å†å²è®°å½•                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI SDK å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AI SDK Core                                            â”‚  â”‚
â”‚  â”‚  â€¢ streamText() - æµå¼æ–‡æœ¬ç”Ÿæˆ                           â”‚  â”‚
â”‚  â”‚  â€¢ generateText() - ä¸€æ¬¡æ€§ç”Ÿæˆ                           â”‚  â”‚
â”‚  â”‚  â€¢ generateObject() - ç»“æ„åŒ–è¾“å‡º                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Tools System                                           â”‚  â”‚
â”‚  â”‚  â€¢ getWeather - å¤©æ°”æŸ¥è¯¢                                 â”‚  â”‚
â”‚  â”‚  â€¢ createDocument - åˆ›å»ºæ–‡æ¡£                             â”‚  â”‚
â”‚  â”‚  â€¢ updateDocument - æ›´æ–°æ–‡æ¡£                             â”‚  â”‚
â”‚  â”‚  â€¢ requestSuggestions - è¯·æ±‚å»ºè®®                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Provider Adapters                                      â”‚  â”‚
â”‚  â”‚  â€¢ xAI Adapter                                          â”‚  â”‚
â”‚  â”‚  â€¢ OpenAI Adapter                                       â”‚  â”‚
â”‚  â”‚  â€¢ Anthropic Adapter                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Vercel AI Gateway                            â”‚
â”‚  â€¢ ç»Ÿä¸€ API å…¥å£                                               â”‚
â”‚  â€¢ è‡ªåŠ¨è´Ÿè½½å‡è¡¡                                                â”‚
â”‚  â€¢ ç¼“å­˜å’Œé™æµ                                                  â”‚
â”‚  â€¢ OIDC è®¤è¯                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LLM æä¾›å•†                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   xAI    â”‚  â”‚  OpenAI  â”‚  â”‚ Anthropicâ”‚  â”‚  Cohere  â”‚    â”‚
â”‚  â”‚  Grok    â”‚  â”‚  GPT-4   â”‚  â”‚  Claude  â”‚  â”‚ Command  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®æŒä¹…å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚ Vercel Blob  â”‚  â”‚    Redis     â”‚      â”‚
â”‚  â”‚  (Neon)      â”‚  â”‚  (æ–‡ä»¶å­˜å‚¨)   â”‚  â”‚   (ç¼“å­˜)     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒæ¶æ„ç»„ä»¶

### 1. Next.js App Router

#### è·¯ç”±ç»“æ„
```
app/
â”œâ”€â”€ (auth)/              # è®¤è¯è·¯ç”±ç»„
â”‚   â”œâ”€â”€ login/           # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ register/        # æ³¨å†Œé¡µ
â”‚   â””â”€â”€ api/auth/        # è®¤è¯ API
â”‚
â””â”€â”€ (chat)/              # èŠå¤©è·¯ç”±ç»„
    â”œâ”€â”€ page.tsx         # é¦–é¡µï¼ˆæ–°å¯¹è¯ï¼‰
    â”œâ”€â”€ chat/[id]/       # èŠå¤©è¯¦æƒ…é¡µ
    â””â”€â”€ api/             # èŠå¤©ç›¸å…³ API
        â”œâ”€â”€ chat/        # èŠå¤©ç«¯ç‚¹
        â”œâ”€â”€ document/    # æ–‡æ¡£ç«¯ç‚¹
        â”œâ”€â”€ files/       # æ–‡ä»¶ä¸Šä¼ 
        â””â”€â”€ history/     # å†å²è®°å½•
```

#### React Server Components (RSC)
```typescript
// æœåŠ¡ç«¯ç»„ä»¶ç¤ºä¾‹
export default async function ChatPage({ params }: { params: { id: string } }) {
  // ç›´æ¥åœ¨æœåŠ¡ç«¯è®¿é—®æ•°æ®åº“
  const chat = await getChatById({ id: params.id });
  const session = await auth();
  
  if (!chat || chat.userId !== session?.user?.id) {
    redirect('/');
  }
  
  return <Chat initialMessages={chat.messages} />;
}
```

**ä¼˜åŠ¿**:
- âœ… é›¶ JavaScript ä¼ è¾“
- âœ… ç›´æ¥æ•°æ®åº“è®¿é—®
- âœ… è‡ªåŠ¨ä»£ç åˆ†å‰²
- âœ… æ›´å¥½çš„ SEO

#### Server Actions
```typescript
// app/(chat)/actions.ts
'use server';

export async function saveChat(chat: Chat) {
  const session = await auth();
  
  if (!session?.user?.id) {
    return { error: 'Unauthorized' };
  }
  
  await db.insert(chatTable).values({
    ...chat,
    userId: session.user.id,
  });
  
  revalidatePath('/');
  return { success: true };
}
```

**ä¼˜åŠ¿**:
- âœ… ç±»å‹å®‰å…¨
- âœ… è‡ªåŠ¨åºåˆ—åŒ–
- âœ… å†…ç½® CSRF ä¿æŠ¤
- âœ… ç®€åŒ– API è°ƒç”¨

---

### 2. AI SDK æ¶æ„

#### æ ¸å¿ƒæµç¨‹

```typescript
// èŠå¤© API ç«¯ç‚¹
export async function POST(request: Request) {
  const { messages, id } = await request.json();
  const session = await auth();
  
  // 1. åˆ›å»ºæµå¼å“åº”
  const result = streamText({
    model: myProvider('chat-model'),
    system: systemPrompt({ selectedChatModel, requestHints }),
    messages: convertToAISDKMessages(messages),
    
    // 2. é…ç½®å·¥å…·
    tools: {
      getWeather: getWeather,
      createDocument: createDocument({ session, dataStream }),
      updateDocument: updateDocument({ session, dataStream }),
      requestSuggestions: requestSuggestions({ session, dataStream }),
    },
    
    // 3. æœ€å¤§è½®æ¬¡
    maxSteps: 5,
    
    // 4. æµå¼å›è°ƒ
    onFinish: async ({ usage }) => {
      await saveChat({ id, messages, usage });
    },
  });
  
  // 5. è¿”å›æµå¼å“åº”
  return result.toDataStreamResponse();
}
```

#### å·¥å…·è°ƒç”¨æœºåˆ¶

```typescript
// lib/ai/tools/create-document.ts
export const createDocument = ({ session, dataStream }) =>
  tool({
    description: "Create a document for writing or content creation",
    inputSchema: z.object({
      title: z.string(),
      kind: z.enum(['text', 'code', 'sheet', 'image']),
    }),
    execute: async ({ title, kind }) => {
      const id = generateUUID();
      
      // 1. é€šçŸ¥å®¢æˆ·ç«¯å¼€å§‹åˆ›å»º
      dataStream.write({ type: 'data-kind', data: kind });
      dataStream.write({ type: 'data-id', data: id });
      dataStream.write({ type: 'data-title', data: title });
      
      // 2. æ ¹æ®ç±»å‹å¤„ç†
      const handler = documentHandlersByArtifactKind.find(
        h => h.kind === kind
      );
      
      // 3. ç”Ÿæˆå†…å®¹
      await handler.onCreateDocument({
        id, title, dataStream, session
      });
      
      // 4. å®Œæˆé€šçŸ¥
      dataStream.write({ type: 'data-finish', data: null });
      
      return { id, title, kind, content: "Document created" };
    },
  });
```

#### æµå¼å“åº”å¤„ç†

```typescript
// å®¢æˆ·ç«¯ä½¿ç”¨ useChat Hook
const { messages, input, handleSubmit, isLoading, data } = useChat({
  api: '/api/chat',
  id: chatId,
  body: { id: chatId },
  
  // å¤„ç†è‡ªå®šä¹‰æ•°æ®æµ
  onFinish: (message) => {
    console.log('Message finished:', message);
  },
  
  // å¤„ç†é”™è¯¯
  onError: (error) => {
    toast.error(error.message);
  },
});
```

---

### 3. Artifacts ç³»ç»Ÿæ¶æ„

#### æ ¸å¿ƒæ¦‚å¿µ

**Artifacts** æ˜¯ä¸€ä¸ªåˆ›æ–°çš„ UI æ¨¡å¼ï¼Œå…è®¸ AI å®æ—¶åˆ›å»ºå’Œç¼–è¾‘æ–‡æ¡£ã€‚

#### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Artifact å®¹å™¨                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   å¯¹è¯åŒºåŸŸ        â”‚  â”‚   Artifact åŒºåŸŸ    â”‚          â”‚
â”‚  â”‚   (å·¦ä¾§)          â”‚  â”‚   (å³ä¾§)           â”‚          â”‚
â”‚  â”‚                   â”‚  â”‚                    â”‚          â”‚
â”‚  â”‚  â€¢ æ¶ˆæ¯åˆ—è¡¨       â”‚  â”‚  â€¢ å®æ—¶é¢„è§ˆ        â”‚          â”‚
â”‚  â”‚  â€¢ è¾“å…¥æ¡†         â”‚  â”‚  â€¢ ç¼–è¾‘å™¨          â”‚          â”‚
â”‚  â”‚  â€¢ å·¥å…·è°ƒç”¨       â”‚  â”‚  â€¢ ç‰ˆæœ¬æ§åˆ¶        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æµ

```typescript
// 1. AI å†³å®šåˆ›å»ºæ–‡æ¡£
LLM â†’ createDocument tool â†’ 
  dataStream.write({ type: 'data-kind', data: 'code' })

// 2. å®¢æˆ·ç«¯æ¥æ”¶å¹¶æ˜¾ç¤º
Client receives stream â†’ 
  Update artifact state â†’ 
  Render CodeEditor

// 3. AI ç”Ÿæˆå†…å®¹
LLM generates code â†’ 
  dataStream.write({ type: 'code-delta', data: chunk })

// 4. å®æ—¶æ›´æ–°ç¼–è¾‘å™¨
Client receives delta â†’ 
  Append to editor content â†’ 
  Update UI
```

#### æ”¯æŒçš„ Artifact ç±»å‹

| ç±»å‹ | ç¼–è¾‘å™¨ | ç”¨é€” |
|------|--------|------|
| **text** | ProseMirror | Markdown æ–‡æ¡£ |
| **code** | CodeMirror | Python ä»£ç  |
| **sheet** | React Data Grid | CSV è¡¨æ ¼ |
| **image** | Custom Canvas | å›¾ç‰‡ç¼–è¾‘ |

---

### 4. æ•°æ®åº“æ¶æ„

#### Schema è®¾è®¡

```typescript
// lib/db/schema.ts

// ç”¨æˆ·è¡¨
export const user = pgTable('User', {
  id: uuid('id').primaryKey().defaultRandom(),
  email: varchar('email', { length: 64 }).notNull(),
  password: varchar('password', { length: 64 }),
});

// èŠå¤©è¡¨
export const chat = pgTable('Chat', {
  id: uuid('id').primaryKey().defaultRandom(),
  createdAt: timestamp('createdAt').notNull(),
  title: text('title').notNull(),
  userId: uuid('userId').references(() => user.id),
  visibility: varchar('visibility', { 
    enum: ['public', 'private'] 
  }).default('private'),
  lastContext: jsonb('lastContext').$type<AppUsage | null>(),
});

// æ¶ˆæ¯è¡¨ (v2)
export const message = pgTable('Message_v2', {
  id: uuid('id').primaryKey().defaultRandom(),
  chatId: uuid('chatId').references(() => chat.id),
  role: varchar('role').notNull(),
  parts: json('parts').notNull(),        // æ¶ˆæ¯éƒ¨åˆ†
  attachments: json('attachments').notNull(), // é™„ä»¶
  createdAt: timestamp('createdAt').notNull(),
});

// æ–‡æ¡£è¡¨
export const document = pgTable('Document', {
  id: uuid('id').defaultRandom(),
  createdAt: timestamp('createdAt').notNull(),
  title: text('title').notNull(),
  content: text('content'),
  kind: varchar('text', { 
    enum: ['text', 'code', 'image', 'sheet'] 
  }).default('text'),
  userId: uuid('userId').references(() => user.id),
}, (table) => ({
  pk: primaryKey({ columns: [table.id, table.createdAt] }),
}));

// å»ºè®®è¡¨
export const suggestion = pgTable('Suggestion', {
  id: uuid('id').defaultRandom(),
  documentId: uuid('documentId').notNull(),
  documentCreatedAt: timestamp('documentCreatedAt').notNull(),
  originalText: text('originalText').notNull(),
  suggestedText: text('suggestedText').notNull(),
  description: text('description'),
  isResolved: boolean('isResolved').default(false),
  userId: uuid('userId').references(() => user.id),
  createdAt: timestamp('createdAt').notNull(),
});

// æŠ•ç¥¨è¡¨ (v2)
export const vote = pgTable('Vote_v2', {
  chatId: uuid('chatId').references(() => chat.id),
  messageId: uuid('messageId').references(() => message.id),
  isUpvoted: boolean('isUpvoted').notNull(),
}, (table) => ({
  pk: primaryKey({ columns: [table.chatId, table.messageId] }),
}));
```

#### å…³ç³»å›¾

```
User (1) â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€ (N) Chat
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€ (N) Document
               â”‚
               â””â”€â”€â”€â”€â”€â”€â”€ (N) Suggestion

Chat (1) â”€â”€â”€â”€â”€â”€ (N) Message
     (1) â”€â”€â”€â”€â”€â”€ (N) Vote

Document (1) â”€â”€ (N) Suggestion
```

---

### 5. è®¤è¯æ¶æ„

#### Auth.js é…ç½®

```typescript
// app/(auth)/auth.ts
import NextAuth from 'next-auth';
import Credentials from 'next-auth/providers/credentials';
import { compare } from 'bcrypt-ts';

export const { handlers, auth, signIn, signOut } = NextAuth({
  providers: [
    Credentials({
      credentials: {
        email: { label: 'Email', type: 'email' },
        password: { label: 'Password', type: 'password' },
      },
      authorize: async (credentials) => {
        const user = await getUserByEmail(credentials.email);
        
        if (!user) return null;
        
        const isValid = await compare(
          credentials.password,
          user.password
        );
        
        if (!isValid) return null;
        
        return { id: user.id, email: user.email };
      },
    }),
  ],
  pages: {
    signIn: '/login',
  },
  callbacks: {
    authorized: async ({ auth }) => {
      return !!auth;
    },
  },
});
```

#### ä¸­é—´ä»¶ä¿æŠ¤

```typescript
// middleware.ts
export { auth as middleware } from '@/app/(auth)/auth';

export const config = {
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)'],
};
```

---

## ğŸ”„ æ•°æ®æµåˆ†æ

### å®Œæ•´å¯¹è¯æµç¨‹

```
1. ç”¨æˆ·è¾“å…¥æ¶ˆæ¯
   â†“
2. å®¢æˆ·ç«¯è°ƒç”¨ useChat.handleSubmit()
   â†“
3. POST /api/chat
   â†“
4. éªŒè¯ç”¨æˆ·èº«ä»½ (auth())
   â†“
5. è°ƒç”¨ AI SDK streamText()
   â†“
6. LLM å¤„ç†å¹¶å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·
   â†“
7a. ä¸è°ƒç”¨å·¥å…· â†’ ç›´æ¥è¿”å›æ–‡æœ¬
   â†“
7b. è°ƒç”¨å·¥å…· â†’ æ‰§è¡Œå·¥å…·å‡½æ•°
   â†“
8. å·¥å…·è¿”å›ç»“æœç»™ LLM
   â†“
9. LLM åŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆå›å¤
   â†“
10. æµå¼è¿”å›ç»™å®¢æˆ·ç«¯
   â†“
11. å®¢æˆ·ç«¯å®æ—¶æ›´æ–° UI
   â†“
12. å®Œæˆåä¿å­˜åˆ°æ•°æ®åº“
```

### Artifact åˆ›å»ºæµç¨‹

```
1. ç”¨æˆ·: "å¸®æˆ‘å†™ä¸€ä¸ª Python æ’åºç®—æ³•"
   â†“
2. LLM å†³å®šè°ƒç”¨ createDocument
   â†“
3. createDocument({ title: "æ’åºç®—æ³•", kind: "code" })
   â†“
4. dataStream.write({ type: 'data-kind', data: 'code' })
   â†“
5. å®¢æˆ·ç«¯æ˜¾ç¤ºä»£ç ç¼–è¾‘å™¨
   â†“
6. LLM ç”Ÿæˆä»£ç å†…å®¹
   â†“
7. dataStream.write({ type: 'code-delta', data: chunk })
   â†“
8. ç¼–è¾‘å™¨å®æ—¶æ›´æ–°
   â†“
9. ç”Ÿæˆå®Œæˆ
   â†“
10. dataStream.write({ type: 'data-finish', data: null })
   â†“
11. ä¿å­˜åˆ°æ•°æ®åº“
```

---

## ğŸ¨ å‰ç«¯æ¶æ„

### ç»„ä»¶å±‚çº§

```
App
â”œâ”€â”€ ThemeProvider
â”‚   â””â”€â”€ Layout
â”‚       â”œâ”€â”€ AppSidebar
â”‚       â”‚   â”œâ”€â”€ SidebarHistory
â”‚       â”‚   â””â”€â”€ SidebarUserNav
â”‚       â”‚
â”‚       â””â”€â”€ Main Content
â”‚           â”œâ”€â”€ ChatHeader
â”‚           â”‚   â”œâ”€â”€ ModelSelector
â”‚           â”‚   â””â”€â”€ VisibilitySelector
â”‚           â”‚
â”‚           â”œâ”€â”€ Chat
â”‚           â”‚   â”œâ”€â”€ Messages
â”‚           â”‚   â”‚   â””â”€â”€ Message[]
â”‚           â”‚   â”‚       â”œâ”€â”€ MessageContent
â”‚           â”‚   â”‚       â”œâ”€â”€ MessageActions
â”‚           â”‚   â”‚       â””â”€â”€ MessageReasoning
â”‚           â”‚   â”‚
â”‚           â”‚   â””â”€â”€ MultimodalInput
â”‚           â”‚       â”œâ”€â”€ Textarea
â”‚           â”‚       â”œâ”€â”€ FileUpload
â”‚           â”‚       â””â”€â”€ SubmitButton
â”‚           â”‚
â”‚           â””â”€â”€ Artifact (conditional)
â”‚               â”œâ”€â”€ ArtifactHeader
â”‚               â”œâ”€â”€ ArtifactContent
â”‚               â”‚   â”œâ”€â”€ TextEditor
â”‚               â”‚   â”œâ”€â”€ CodeEditor
â”‚               â”‚   â”œâ”€â”€ SheetEditor
â”‚               â”‚   â””â”€â”€ ImageEditor
â”‚               â””â”€â”€ ArtifactActions
```

### çŠ¶æ€ç®¡ç†

```typescript
// ä½¿ç”¨ React Context + Hooks
const DataStreamContext = createContext<DataStreamState>();

// å…¨å±€çŠ¶æ€
- messages: ChatMessage[]
- isLoading: boolean
- artifact: ArtifactState | null
- suggestions: Suggestion[]
- usage: AppUsage | null

// æœ¬åœ°çŠ¶æ€
- input: string
- attachments: Attachment[]
- selectedModel: string
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ä»£ç åˆ†å‰²
```typescript
// åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶
const CodeEditor = dynamic(() => import('@/components/code-editor'), {
  loading: () => <DocumentSkeleton />,
  ssr: false,
});
```

### 2. æµå¼å“åº”
```typescript
// é™ä½é¦–å­—èŠ‚æ—¶é—´ (TTFB)
const stream = streamText({
  model: myProvider('chat-model'),
  messages,
  onChunk: (chunk) => {
    // ç«‹å³å‘é€ç»™å®¢æˆ·ç«¯
    controller.enqueue(encoder.encode(chunk));
  },
});
```

### 3. æ•°æ®åº“ä¼˜åŒ–
```typescript
// ä½¿ç”¨ç´¢å¼•
export const chat = pgTable('Chat', {
  id: uuid('id').primaryKey(),
  userId: uuid('userId').references(() => user.id),
  // è‡ªåŠ¨åˆ›å»ºç´¢å¼•
}, (table) => ({
  userIdIdx: index('user_id_idx').on(table.userId),
}));

// è¿æ¥æ± 
const db = drizzle(sql, {
  poolConfig: {
    max: 10,
    idleTimeoutMillis: 30000,
  },
});
```

### 4. ç¼“å­˜ç­–ç•¥
```typescript
// SWR å®¢æˆ·ç«¯ç¼“å­˜
const { data: chats } = useSWR('/api/history', fetcher, {
  revalidateOnFocus: false,
  dedupingInterval: 60000,
});

// Redis æœåŠ¡ç«¯ç¼“å­˜
const cachedData = await redis.get(`chat:${id}`);
if (cachedData) return JSON.parse(cachedData);
```

---

## ğŸ”’ å®‰å…¨æ¶æ„

### 1. è®¤è¯å±‚
- âœ… Auth.js ä¼šè¯ç®¡ç†
- âœ… JWT Token
- âœ… å¯†ç åŠ å¯† (bcrypt)

### 2. æˆæƒå±‚
- âœ… ç”¨æˆ·çº§åˆ«éš”ç¦»
- âœ… èµ„æºæ‰€æœ‰æƒéªŒè¯
- âœ… ä¸­é—´ä»¶ä¿æŠ¤

### 3. æ•°æ®å±‚
- âœ… SQL æ³¨å…¥é˜²æŠ¤ (Drizzle ORM)
- âœ… XSS é˜²æŠ¤ (React è‡ªåŠ¨è½¬ä¹‰)
- âœ… CSRF é˜²æŠ¤ (Server Actions)

### 4. API å±‚
- âœ… é€Ÿç‡é™åˆ¶
- âœ… è¾“å…¥éªŒè¯ (Zod)
- âœ… é”™è¯¯å¤„ç†

---

## ğŸ“Š ç›‘æ§å’Œå¯è§‚æµ‹æ€§

### 1. OpenTelemetry é›†æˆ
```typescript
// instrumentation.ts
import { registerOTel } from '@vercel/otel';

export function register() {
  registerOTel({ serviceName: 'ai-chatbot' });
}
```

### 2. ä½¿ç”¨è¿½è¸ª
```typescript
// è‡ªåŠ¨è¿½è¸ª API è¯·æ±‚
// è‡ªåŠ¨è¿½è¸ªæ•°æ®åº“æŸ¥è¯¢
// è‡ªåŠ¨è¿½è¸ª LLM è°ƒç”¨
```

### 3. åˆ†æ
```typescript
// Vercel Analytics
import { Analytics } from '@vercel/analytics/react';

<Analytics />
```

---

## âœ… æ¶æ„ä¼˜åŠ¿

1. **æ¨¡å—åŒ–** - æ¸…æ™°çš„åˆ†å±‚å’ŒèŒè´£åˆ†ç¦»
2. **å¯æ‰©å±•** - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œå·¥å…·
3. **ç±»å‹å®‰å…¨** - å…¨æ ˆ TypeScript
4. **æ€§èƒ½ä¼˜åŒ–** - RSCã€æµå¼å“åº”ã€ç¼“å­˜
5. **å¼€å‘ä½“éªŒ** - çƒ­é‡è½½ã€ç±»å‹æç¤ºã€é”™è¯¯å¤„ç†
6. **ç”Ÿäº§å°±ç»ª** - è®¤è¯ã€ç›‘æ§ã€éƒ¨ç½²

---

**åˆ†ææ—¥æœŸ**: 2025-01-XX  
**é¡¹ç›®ç‰ˆæœ¬**: v3.1.0
